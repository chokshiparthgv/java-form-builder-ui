<div class="pd-20"  *ngIf="!isLoading">
  <mat-card class="gap-20">
    <mat-card-header>
      <mat-card-title>
        <div class="d-flex flex-start gap-20">
          <span (click)="this.navigationServiceProvider.navigateToServiceList()">
            <mat-icon class="font-size-32 display-hover" title="back to roles">keyboard_arrow_left</mat-icon>
          </span>
          <span>New Form</span>
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div>
        <form class="gap-20 d-flex d-flex-dir-col" [formGroup]="this.genericForm">
          <div class="d-flex gap-20">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Form Name</mat-label>
              <input type="text" matInput formControlName="name" />
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Description</mat-label>
              <input type="text" matInput formControlName="description" />
            </mat-form-field>
          </div>
          <h2>Form Fields</h2>
          <div formArrayName="fields" class="d-flex gap-10 flex-direction-col">
            <div *ngFor="let field of this.fields.controls; let i = index">
              <h4>{{ this.fieldTitleInfo[i] }} Field</h4>
              <div [formGroupName]="i" style="align-items: flex-start"
                class="d-flex gap-10 flex-direction-row ai-center">
                <div class="remove-icon">
                  <mat-icon (click)="removeField(i)" class="display-hover color-danger">remove_circle_outline</mat-icon>
                </div>

                <!-- single input -->
                <ng-container *ngIf="
                    this.fieldTitleInfo[i] == 'Text' ||
                    this.fieldTitleInfo[i] == 'Number' ||
                    this.fieldTitleInfo[i] == 'Date'
                  ">
                  <div *ngFor="
                      let controlName of controlsKey(field);
                      let controlCount = index
                    ">
                    <!-- Field display name-->
                    <ng-container *ngIf="controlName == 'name'">
                      <mat-form-field appearance="outline">
                        <mat-label>Name</mat-label>
                        <input type="text" matInput formControlName="{{ controlName }}" />
                      </mat-form-field>
                    </ng-container>

                    <!-- Default value-->
                    <ng-container *ngIf="
                        controlName == 'defaultValue' &&
                        this.fieldTitleInfo[i] == 'Text'
                      ">
                      <mat-form-field appearance="outline">
                        <mat-label>Default Value</mat-label>
                        <input type="text" matInput formControlName="{{ controlName }}" />
                      </mat-form-field>
                    </ng-container>

                    <!-- Default date value -->
                    <ng-container *ngIf="
                        controlName == 'defaultValue' &&
                        this.fieldTitleInfo[i] == 'Date'
                      ">
                      <mat-form-field appearance="outline">
                        <mat-label>Default Date Value</mat-label>
                        <input matInput [matDatepicker]="dp1" formControlName="{{ controlName }}" />
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matIconSuffix [for]="dp1"></mat-datepicker-toggle>
                        <mat-datepicker #dp1></mat-datepicker>
                      </mat-form-field>
                    </ng-container>

                    <!-- Default number value -->
                    <ng-container *ngIf="
                        controlName == 'defaultValue' &&
                        this.fieldTitleInfo[i] == 'Number'
                      ">
                      <mat-form-field appearance="outline">
                        <mat-label>Default Value</mat-label>
                        <input type="number" matInput formControlName="{{ controlName }}" />
                      </mat-form-field>
                    </ng-container>

                    <!-- Placeholder-->
                    <ng-container *ngIf="controlName == 'placeholder'">
                      <mat-form-field appearance="outline">
                        <mat-label>Placeholder</mat-label>
                        <input type="text" matInput formControlName="{{ controlName }}" />
                      </mat-form-field>
                    </ng-container>

                    <!-- Regex -->
                    <ng-container *ngIf="controlName == 'regex'">
                      <mat-form-field appearance="outline">
                        <mat-label>Regex</mat-label>
                        <input type="text" matInput formControlName="{{ controlName }}" />
                      </mat-form-field>
                    </ng-container>

                    <!-- Required for checkbox -->
                    <ng-container *ngIf="
                        controlName == 'required' &&
                        this.fieldTitleInfo[i] == 'checkbox'
                      ">
                      <mat-form-field appearance="outline">
                        <mat-label>Is required</mat-label>
                        <mat-select matInput formControlName="required" [value]="false">
                          <mat-option [value]="true">Yes</mat-option>
                          <mat-option [value]="false">No</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </ng-container>

                    <!-- Required -->
                    <ng-container *ngIf="controlName == 'required'">
                      <mat-form-field appearance="outline">
                        <mat-label>Is required</mat-label>
                        <mat-select matInput formControlName="required" [value]="false">
                          <mat-option [value]="true">Yes</mat-option>
                          <mat-option [value]="false">No</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </ng-container>
                  </div>
                </ng-container>

                <!-- group input -->
                <ng-container *ngIf="this.fieldTitleInfo[i] == 'Checkbox' || this.fieldTitleInfo[i] == 'Radio' || this.fieldTitleInfo[i] == 'Dropdown'">
                  <span *ngFor="
                      let controlName of controlsKey(field);
                      let controlCount = index
                    ">
                    <!-- Field display name-->
                    <ng-container *ngIf="controlName == 'name'">
                      <mat-form-field appearance="outline">
                        <mat-label>{{this.fieldTitleInfo[i]}}</mat-label>
                        <input type="text" matInput formControlName="{{ controlName }}" />
                      </mat-form-field>
                    </ng-container>

                    <ng-container *ngIf="controlName == 'fields'">
                      <div formArrayName="fields" class="d-flex gap-10 flex-direction-col">
                        <span *ngFor="
                            let subField of getSubFields(i).controls;
                            let j = index
                          ">
                          <div [formGroupName]="j" class="d-flex gap-10 flex-direction-row ai-center">
                            <div *ngFor="
                                let controlName of controlsKey(subField);
                                let controlCount = index
                              ">
                              <ng-container *ngIf="controlName == 'name'">
                                <mat-form-field appearance="outline">
                                  <mat-label>Name</mat-label>
                                  <input type="text" matInput formControlName="{{ controlName }}" />
                                </mat-form-field>
                              </ng-container>
                            </div>
                          </div>
                        </span>
                      </div>
                    </ng-container>
                  </span>

                  <ng-container>
                    <mat-icon (click)="addFieldInGroup(i)" class="display-hover">add_circle_outline</mat-icon>
                  </ng-container>
                </ng-container>
              </div>
              <hr />
            </div>

            <!-- add field menu -->
            <div class="d-flex justify-content-center">
              <mat-icon class="display-hover" [mat-menu-trigger-for]="fieldOptions">add_circle_outline</mat-icon>
              <mat-menu #fieldOptions="matMenu">
                <div *ngFor="let type of fieldTypes" class="d-flex mrg-5 menu-list gap-10 display-hover bg-white-hover pd-5"
                  (click)="addFieldType(type)">
                  <mat-icon>{{ type.icon }}</mat-icon> {{ type.label }}
                </div>
              </mat-menu>
            </div>
          </div>
          <div>
            <button mat-flat-button color="primary" [disabled]="this.genericForm.invalid" (click)="saveGenericForm()">
              Save
            </button>
          </div>
        </form>
      </div>
    </mat-card-content>
  </mat-card>
</div>
<div *ngIf="isLoading" class="d-flex justify-content-center pd-20">
  <div class="loader"></div>
</div>